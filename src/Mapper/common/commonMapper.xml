<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="commonMapper">
    <!-- 다국어 조회 -->
    <select id="getLangCode" parameterType="map" resultType="map">
        SELECT TYPE,
               SUBSTRING(UNIQUE_ID, CHARINDEX('_', UNIQUE_ID) + 1, LEN(UNIQUE_ID)) AS UNIQUE_ID,
               KOR_NM,
               ISNULL((CASE WHEN #{LANG} = 'KOR' THEN KOR_NM WHEN #{LANG} = 'ENG' THEN ENG_NM WHEN #{LANG} = 'CHN' THEN CHN_NM ELSE KOR_NM END), KOR_NM) AS LANG
        FROM MESSAGE_INFO
        WHERE LEFT(UNIQUE_ID, #{TYPE}) LIKE '%' + #{SCREEN} + '%'
          AND USE_YN = 'Y'
        ORDER BY TYPE, SORT_NO;
    </select>
    
	<!-- 공통코드 조회 -->
    <select id="getCommonCode" parameterType="map" resultType="map">
		EXEC GET_COMMONCODE #{sysClassCd}
    </select>
    
	<!-- 공통코드 조회 -->
    <select id="getCommonCodeEsc" parameterType="map" resultType="map">
		EXEC GET_COMMONCODE_ESC #{sysClassCd}
    </select>

    <!-- 카드정보 조회 -->
    <select id="getCommonCodeCard" parameterType="map" resultType="map">
        SELECT COMPANY,
               (SELECT SYS_ITEM_NAME FROM SYSCODE_DETAIL S WHERE SYS_CLASS_CD LIKE #{sysClassCd} AND SYS_ITEM_CD LIKE COMPANY) AS COMPANY_NM,
               CARD_NUM
        FROM CARD_INFO
        <if test='DEPT_CD != "M"'>
            WHERE USER_ID = #{USER_ID}
        </if>
        ORDER BY COMPANY;
    </select>

    <!-- 권한분류 조회 -->
    <select id="getAuthCode" parameterType="map" resultType="map">
		EXEC GET_AUTHCODE
	</select>
    
    <!-- 로그 저장 -->
    <insert id="insertMenuLog" parameterType="map">
		EXEC MENULOG_INS #{SYS_ID}, #{USER_ID}, #{MENU_ID}, #{USER_IP}, #{HOST_NM}, #{DEPT_CD}
    </insert>
    
    <!-- 예외사항 저장 -->
    <insert id="insertExceptionLog" parameterType="map">
		EXEC EXCEPTIONLOG_INS #{USER_ID}, #{USER_IP}, #{EVNT_CD}, #{EVNT_NM}, #{EVNT_DETAIL}, #{EVNT_SVRY}, #{PROG_NM}, #{HOST_NM}
    </insert>
    
    <!-- 권한부여/변경 사항 저장 -->
    <insert id="insertAuthChange" parameterType="map">
        INSERT INTO LOG_USER_AUTH(SYS_ID, PROCESS_DT, USER_ID, USER_IP,
                                  EVNT_NM, EVNT_SVRY, HOST_NM, DEPT_CD)
        VALUES('HCNC', CONVERT(VARCHAR(19), GETDATE(), 121), #{USER_ID},
               #{USER_IP}, #{EVNT_NM}, #{EVNT_SVRY}, #{HOST_NM}, #{DEPT_CD});
    </insert>    
    
    <!-- 사용자 정보 변경 저장 -->
    <insert id="insertUserInfo" parameterType="map">
    	EXEC CM0000_EXCEPTION_USER_INS #{REG_USERID}, #{REG_IP}, #{HOST_NM}, #{USER_ID}
    </insert>
    
    <!-- 시스템코드 목록 -->
    <select id="selectLists" parameterType="map" resultType="map">
    	SELECT SYS_ITEM_CD AS CODE, SYS_ITEM_NAME AS VALUE
		  FROM SYSCODE_DETAIL
		 WHERE SYS_CLASS_CD = #{LIST_TYPE}
		 ORDER BY SYS_ITEM_CD
    </select>

    <select id="selectSalesNum" parameterType="map" resultType="map">
        SELECT DISTINCT PROJECT_NM AS CODE, SALES_NUM AS VALUE FROM SALES_INQUIRY_INFO
    </select>
</mapper>